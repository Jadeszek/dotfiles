#!/bin/zsh

# Mirrors directories specified in syncdir from SENDER to RECEIVER

# Options
RECEIVER="/media/MyBook" # needs to be in /etc/fstab
SENDER="/media/storage"
UMOUNT=0

# rsync command-line-options
rsynccli=("-r" # recursive
	  "-h" # print human-readable values
	  "-u" # skip files, that are newer on the receiver
	  "--ignore-existing" # skip files existing on receiver
	  "--progress" # print a progress bar
	  "--delete" # delete files only on receiver
)
# directories
syncdir=("Filme")


# check if we're mounted
mountpoint $RECEIVER >/dev/null
if [[ $? != 0 ]]; then
    print "** mounting $RECEIVER\n"
    UMOUNT=1
    mount $RECEIVER
fi

# the actual synchronization
for i in $syncdir[@]; do
    print "** synchronizing $i"
    rsync $rsynccli[@] $SENDER/$i/ $RECEIVER/$i/
    print ""
done

# if we mounted before we umount
if [[ $UMOUNT == 1 ]]; then
    print "** umounting $RECEIVER"
    umount $RECEIVER
fi

